% !TeX root = ../document.tex
% !TeX encoding = UTF-8 Unicode

\begin{figure}[ht!]
  \centering
  \captionsetup{justification=centering}
  % \resizebox{0.8\linewidth}{!}{%
  \begin{tikzpicture}[node distance=1cm,block/.style={align=center,draw,shape=rectangle,very thick,minimum height=2em, minimum width=3em},>={Stealth}]

    \node (r)  []                      {\(r(k)\)};
    \node (cg) [block, right=of r]     {Command\\Governor};
    \node (C)  [block, right=of cg]    {Primal\\Controller};
    \node (G)  [block, right=of C]     {System};
    \node (y)  [right=of G.north east] {\(y(k)\)};
    \node (c)  [right=of G.south east] {\(c(k)\)};
    \node (e)  [below=of C]            {\(\begin{bmatrix}x_{c}(k)\\x(k)\end{bmatrix}\)};
    \node [draw=blue,rectangle,dashed,fit=(C) (G) (e)] {};

    \draw [->, thick] (r) -- (cg);
    \draw [->, thick] (cg) -- node [above] {\(g(k)\)} (C);
    \draw [->, thick] (C) -- node (u) [above] {\(u(k)\)} (G);

    \draw [->, thick] ([yshift=-3mm]G.north east) -- (y.west);
    \draw [->, thick] ([yshift=3mm]G.south east) -- (c.west);
    \draw [->, thick] (G) |- node (x) [near start, above right] {\(x(k)\)} ([yshift=1em]e.south east);
    \draw [->, thick] (x) -| ([xshift=5mm]C.south);
    \draw [->, thick] (C) -- node [left] {\(x_{c}(k)\)} (e.north);
    \draw [->, thick] (e.west) -| (cg.south);
  \end{tikzpicture}%
  % }
  \caption{Command Governor Block Diagram.}%
  \label{fig:cg-schematic}
\end{figure}

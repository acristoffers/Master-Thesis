% !TeX root = document.tex
% !TeX encoding = UTF-8 Unicode

\chapter{Practical Implementation Aspects}%
\label{chp:practival-implementation-aspects}

When implementing the techniques described in this thesis, some details need
attention. For example, it is easy to say
\enquote{\(\mathrm{minimize}~f(x)~|~x\in\mathcal{X}\)}, however it is not so
simple (and sometimes even possible) to implement the \(x\in\mathcal{X}\) bit.
Describing the set and finding a way to test membership numerically can be
challenging, that is one reason why we choose convex sets: we know how to
implement membership tests and use it in common optimization frameworks.

This chapter will discuss how to represent the constraints and region of
attraction, as well as provide some insight on how to implemente the models of
the command governor with a supervisor structure, the problems faced when
resetting integrators and estimating the region of attraction.

\section{Polytope representations}%
\label{sec:polytope-representation}

Any convex region can be approximated by a convex polytope. A convex polytope is
defined as a compact convex set with a finite number of extreme points such
that, for any two distinct points \((a,b)\) belonging to the region, a closed
segment with endpoints \((a,b)\) is entirely contained within the
region~\parencite{gr√ºnbaum:convex}. In other words, it is a convex hull of a
finite number of points, called vertices. This representation is called the
\enquote{V-representation} and is not useful to test membership, however is very
simple to sample points from the boundaries of the desired region/set to create
a V-representation of a polytope that approximates it. It is also useful for
plotting. The Figure~\ref{fig:v-rep-example} illustrates a region in its
V-representation, where the red dots are the vertices, and all blue dots are
considered to be inside the region. The set of vertices is
\resizebox{\linewidth}{!}{%
	\(\{(0.02,0.71),(0.31,0.02),(0.82,0.04),(0.87,0.13),(0.99,0.88),(0.60,0.98),(0.38,0.97),(0.04,0.88),(0.02,0.82)\}\)}.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=\linewidth]{imgs/v-rep}
	\caption{Visualization of the V-representation of a set}%
	\label{fig:v-rep-example}
\end{figure}

A more useful representation of such regions is the \enquote{H-representation}.
In this representation the region is described the intersection of a finite
number of half-spaces. A half-space is one of the two parts in which a
hyper-plane divides a affine space. Since half-spaces are written as linear
inequalities, the H-representation becomes the matricial inequality
%
\begin{equation}
	Ax\leq{}b,
\end{equation}
%
where \(A\) is a matrix of coefficients, \(x\) is a point in space and \(b\) is
a vector of real numbers. The number of rows in \(A\) and \(b\) is the same as
the number of half-spaces defining the region. All points satisfying the
inequality are in the interior of the region, making it easy to test set
membership. Figure~\ref{fig:h-rep-example} shows the half-spaces that compose
the H-representation of the same convex polytope presented in
Figure~\ref{fig:v-rep-example}. The inequation that describes the region is
shown in Equation~\ref{eq:h-rep-example}. The selected side is not shown for
each half-space, but is the one which intersections with the other selected
halves make the convex region in the middle.

\begin{equation}
	\label{eq:h-rep-example}
	\begin{bmatrix}
		-0.91 & -0.39 \\
		0.04  & -0.99 \\
		0.98  & -0.15 \\
		0.84  & -0.54 \\
		-0.24 & 0.96  \\
		0.24  & 0.97  \\
		-0.06 & 0.99  \\
		-0.99 & 0.03  \\
		-0.93 & 0.34
	\end{bmatrix}x \leq
	\begin{bmatrix}
		-0.30 \\
		-0.01 \\
		0.84  \\
		0.66  \\
		0.84  \\
		1.10  \\
		0.94  \\
		0.00  \\
		0.26
	\end{bmatrix}
\end{equation}

\begin{figure}[!htb]
	\centering
	\includegraphics[width=\linewidth]{imgs/h-rep}
	\caption{Visualization of the H-representation of a set}%
	\label{fig:h-rep-example}
\end{figure}

Given that the V-representation is easier to obtain from generic shapes but the
H-representation is more useful when verifying set membership, it is important
to have a way to switch between them. Unfortunately this is not straightforwad,
but there are algorithms that allows to enumerate the facets given the vertices.
Some problems of such algorithms are the time needed to find the facets if there
are many vertices and how to find facets in higher order spaces. There are
however good algorithms that can be used for the conversion, specially if the
computation will be offline
\parencite{avis.bremner.ea:how,graham.frances-yao:finding,lee:on,mccallum.avis:linear}.

Particular regions can be easily described in a way that is easy to include in
optimization problems. The ellipsoid is on such region, as it can be described
as \(x^{T}Px\leq{}1\), so that any point that satisfies the inequality is inside
the region. Many regions described by polynoms can be expressed in a matricial
form, and hence can be used to easily test membership. For such regions, is
better to use its inequation directly than to transform it into a polytope.
This is the case of the Region of Attraction and is how we implemented the check
to verify if the state is inside it.

\section{Internal Models}%
\label{sec:internal-models}

Internal Models

\section{Integrator Reset}%
\label{sec:integrator-reset}

Integrator Reset

\section{Region of Attraction Estimation}%
\label{sec:roa-estimation}

Region of Attraction Estimation
